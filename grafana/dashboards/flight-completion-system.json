{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  completion_method as \"Completion Method\",\n  COUNT(*) as \"Total Completions\",\n  ROUND(AVG(EXTRACT(EPOCH FROM (completed_at - created_at))/60), 1) as \"Avg Duration (min)\",\n  ROUND(AVG(completion_confidence), 2) as \"Avg Confidence\",\n  COUNT(CASE WHEN completed_at >= NOW() - INTERVAL '1 hour' THEN 1 END) as \"Last Hour\",\n  COUNT(CASE WHEN completed_at >= NOW() - INTERVAL '24 hours' THEN 1 END) as \"Last 24h\"\nFROM flights \nWHERE status = 'completed' \n  AND completion_method IS NOT NULL\nGROUP BY completion_method\nORDER BY \"Total Completions\" DESC",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Flight Completion Statistics (All Time)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 2,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  status as \"Status\",\n  COUNT(*) as \"Count\",\n  ROUND(COUNT(*)::numeric / SUM(COUNT(*)) OVER() * 100, 1) as \"Percentage\",\n  CASE \n    WHEN status = 'active' THEN 'Currently flying'\n    WHEN status = 'stale' THEN 'No recent updates'\n    WHEN status = 'landed' THEN 'Landed but pilot connected'\n    WHEN status = 'completed' THEN 'Pilot disconnected'\n    WHEN status = 'cancelled' THEN 'Flight cancelled'\n    ELSE 'Unknown'\n  END as \"Description\"\nFROM flights \nGROUP BY status\nORDER BY \"Count\" DESC",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Flight Status Distribution",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "id": 3,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  callsign as \"Callsign\",\n  departure as \"Departure\",\n  arrival as \"Arrival\",\n  landed_at as \"Landed At\",\n  ROUND(EXTRACT(EPOCH FROM (NOW() - landed_at))/60, 1) as \"Minutes Landed\",\n  completion_method as \"Completion Method\",\n  ROUND(completion_confidence, 2) as \"Confidence\"\nFROM flights \nWHERE status = 'landed' \n  AND landed_at IS NOT NULL\nORDER BY landed_at DESC\nLIMIT 15",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 15
          }
        }
      ],
      "title": "Landed Flights (Pilots Still Connected)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "id": 4,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  callsign as \"Callsign\",\n  completion_method as \"Method\",\n  completed_at as \"Completed At\",\n  pilot_disconnected_at as \"Pilot Disconnected At\",\n  disconnect_method as \"Disconnect Method\",\n  ROUND(completion_confidence, 2) as \"Confidence\",\n  ROUND(EXTRACT(EPOCH FROM (completed_at - created_at))/60, 1) as \"Duration (min)\",\n  departure as \"From\",\n  arrival as \"To\"\nFROM flights \nWHERE status = 'completed' \n  AND completed_at IS NOT NULL\n  AND completed_at >= NOW() - INTERVAL '24 hours'\nORDER BY completed_at DESC\nLIMIT 15",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 15
          }
        }
      ],
      "title": "Recent Completed Flights (Last 24h)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "id": 5,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  airport_code as \"Airport\",\n  movement_type as \"Movement Type\",\n  COUNT(*) as \"Total Movements\",\n  COUNT(CASE WHEN flight_completion_triggered THEN 1 END) as \"Completion Triggered\",\n  ROUND(COUNT(CASE WHEN flight_completion_triggered THEN 1 END)::numeric / COUNT(*) * 100, 1) as \"Trigger Rate %\",\n  ROUND(AVG(completion_confidence), 2) as \"Avg Confidence\"\nFROM traffic_movements \nWHERE timestamp >= NOW() - INTERVAL '24 hours'\nGROUP BY airport_code, movement_type\nHAVING COUNT(*) > 0\nORDER BY \"Completion Triggered\" DESC\nLIMIT 20",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 20
          }
        }
      ],
      "title": "Landing Detection Performance (Last 24h)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "id": 6,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  callsign as \"Callsign\",\n  departure as \"Departure\",\n  arrival as \"Arrival\",\n  status as \"Status\",\n  last_updated as \"Last Updated\",\n  CASE \n    WHEN status = 'landed' THEN 'Landed (Pilot Connected)'\n    WHEN status = 'completed' THEN 'Completed (Pilot Disconnected)'\n    WHEN status = 'active' THEN 'Active'\n    WHEN status = 'stale' THEN 'Stale'\n    ELSE status\n  END as \"Flight Status\",\n  completion_method as \"Completion Method\",\n  ROUND(completion_confidence, 2) as \"Confidence\",\n  ROUND(EXTRACT(EPOCH FROM (NOW() - last_updated))/60, 1) as \"Minutes Since Update\"\nFROM flights \nWHERE status IN ('active', 'stale', 'landed', 'completed')\n  AND (departure LIKE 'YS%' OR arrival LIKE 'YS%')\nORDER BY last_updated DESC\nLIMIT 25",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 25
          }
        }
      ],
      "title": "Sydney Airport Flights - Enhanced Status",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 24
      },
      "id": 7,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "WITH completion_stats AS (\n  SELECT \n    DATE_TRUNC('hour', completed_at) as hour,\n    completion_method,\n    disconnect_method,\n    COUNT(*) as completions,\n    ROUND(AVG(completion_confidence), 2) as avg_confidence,\n    ROUND(AVG(EXTRACT(EPOCH FROM (completed_at - landed_at))/60), 1) as avg_time_landed_minutes\n  FROM flights \n  WHERE status = 'completed' \n    AND completed_at IS NOT NULL\n    AND completed_at >= NOW() - INTERVAL '7 days'\n  GROUP BY DATE_TRUNC('hour', completed_at), completion_method, disconnect_method\n)\nSELECT \n  hour as \"Hour\",\n  completion_method as \"Method\",\n  disconnect_method as \"Disconnect Method\",\n  completions as \"Completions\",\n  avg_confidence as \"Avg Confidence\",\n  avg_time_landed_minutes as \"Avg Time Landed (min)\"\nFROM completion_stats\nORDER BY hour DESC, completions DESC\nLIMIT 50",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Enhanced Hourly Completion Trends (Last 7 Days)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 32
      },
      "id": 8,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  disconnect_method as \"Disconnect Method\",\n  COUNT(*) as \"Total Disconnects\",\n  ROUND(AVG(EXTRACT(EPOCH FROM (pilot_disconnected_at - landed_at))/60), 1) as \"Avg Time Landed (min)\",\n  COUNT(CASE WHEN pilot_disconnected_at >= NOW() - INTERVAL '1 hour' THEN 1 END) as \"Last Hour\",\n  COUNT(CASE WHEN pilot_disconnected_at >= NOW() - INTERVAL '24 hours' THEN 1 END) as \"Last 24h\"\nFROM flights \nWHERE status = 'completed' \n  AND pilot_disconnected_at IS NOT NULL\n  AND disconnect_method IS NOT NULL\nGROUP BY disconnect_method\nORDER BY \"Total Disconnects\" DESC",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Pilot Disconnect Statistics",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "postgres"
      },
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "align": "auto",
            "displayMode": "auto",
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "blue",
                "value": 1
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 32
      },
      "id": 9,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "datasource": {
            "type": "postgres",
            "uid": "postgres"
          },
          "editorMode": "code",
          "format": "table",
          "rawQuery": true,
          "rawSql": "SELECT \n  'Active' as \"Status\",\n  COUNT(*) as \"Count\",\n  'Currently flying' as \"Description\"\nFROM flights \nWHERE status = 'active'\nUNION ALL\nSELECT \n  'Landed' as \"Status\",\n  COUNT(*) as \"Count\",\n  'Landed but pilot connected' as \"Description\"\nFROM flights \nWHERE status = 'landed'\nUNION ALL\nSELECT \n  'Completed' as \"Status\",\n  COUNT(*) as \"Count\",\n  'Pilot disconnected' as \"Description\"\nFROM flights \nWHERE status = 'completed'\nUNION ALL\nSELECT \n  'Stale' as \"Status\",\n  COUNT(*) as \"Count\",\n  'No recent updates' as \"Description\"\nFROM flights \nWHERE status = 'stale'\nORDER BY \"Count\" DESC",
          "refId": "A",
          "sql": {
            "columns": [
              {
                "parameters": [],
                "type": "function"
              }
            ],
            "groupBy": [
              {
                "property": {
                  "type": "string"
                },
                "type": "groupBy"
              }
            ],
            "limit": 50
          }
        }
      ],
      "title": "Current Flight Status Summary",
      "type": "table"
    }
  ],
  "refresh": "30s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": [
    "vatsim",
    "completion",
    "landing",
    "landed",
    "disconnect",
    "monitoring"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Enhanced Flight Completion System Dashboard",
  "uid": "flight-completion-system",
  "version": 2,
  "weekStart": ""
} 